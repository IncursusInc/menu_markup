<?php

/**
 * @file
 * Contains menu_markup.module.
 */

use Drupal\Core\Url;
use Drupal\menu_markup\Controller\MenuMarkupController;

/**
 * Implements hook_install().
 */
function menu_markup_install() {

  $url = Url::fromRoute('menu_markup_configure');

  drupal_set_message(t('Congrats! menu_markup settings are available under ' . \Drupal::l('the configuration menu', $url)));
}

/**
 * Admin form to configure markup for menu titles.
 *
 * @param array $form
 * @param \Drupal\Core\Form\FormStateInterface $form_state
 *
 * @return array
 */
function menu_markup_form($form, &$form_state) {

  $form['menu_markup_configuration'] = array(
    '#type' => 'textarea',
    '#title' => t('Menu Markup Configuration'),
    '#rows' => 15,
    '#required' => TRUE,
    '#default_value' => variable_get('menu_markup_configuration', ''),
  );

  return system_settings_form($form);
}

/**
 * Implements hook_menu_links_discovered_alter().
 */
function menu_markup_menu_links_discovered_alter(&$links) {

  // Creat a new MenuMarkupController object.
  $markup = new MenuMarkupController(Drupal::service('config.factory'), Drupal::service('entity.query'), $links);

  // Parse the menu config as performed in the admin panel.
  $markup->parseMenuConfig();

  // Rebuild the menu links!
  if ($markup->haveLinks()) {
    $links = $markup->rebuildMenuLinks();
  }
}
